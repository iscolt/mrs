<!DOCTYPE html>
<html lang="cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Mrs | 电影推荐</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{../assets/plugins/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" href="../assets/plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/AdminLTE.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="../assets/css/ionicons.min.css">
    <link rel="stylesheet" href="../assets/css/skins/_all-skins.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/plugins/bootstrap-slider/slider.css">
    <script src="/assets/js/vue.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="../assets/plugins/jquery/jquery.min.js"></script>
    <script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/adminlte.js"></script>
    <script src="../assets/plugins/toast/js/jquery.toast.min.js"></script>
    <script src="../assets/plugins/bootstrap-slider/bootstrap-slider.js"></script>
</head>
<body style="background-color: #81bfde">
<div id="app" >
    <!-- 引入header -->
    <div th:replace="./commons/_header.html" ></div>
    <div>
        <div class="common row" style="top: 50px;">
            <div class="col-md-1"></div>
            <div class="col-md-6">
                <div class="box box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title">热门推荐</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                            <ol class="carousel-indicators">
                                <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                                <li data-target="#carousel-example-generic" data-slide-to="1" class=""></li>
                                <li data-target="#carousel-example-generic" data-slide-to="2" class=""></li>
                            </ol>
                            <div class="carousel-inner">
                                <div class="item active">
                                    <img src="https://i0.hdslb.com/bfs/archive/133edbe684dc612c86f4702b40724758636387d5.jpg@1100w_484h_1c_100q.jpg" alt="First slide" width="100%;">

                                    <div class="carousel-caption">
                                        广告位1
                                    </div>
                                </div>
                                <div class="item">
                                    <img src="https://i0.hdslb.com/bfs/archive/8148a2adc8f93a79ed357584adaf110c7ee61c97.png@1100w_484h_1c_100q.png" alt="Second slide" width="100%;">

                                    <div class="carousel-caption">
                                        广告位2
                                    </div>
                                </div>
                                <div class="item">
                                    <img src="https://i0.hdslb.com/bfs/archive/66ebed194e1e045f5563082122abee8c0605680b.jpg@1100w_484h_1c_100q.jpg" alt="Third slide" width="100%;">

                                    <div class="carousel-caption">
                                        广告位3
                                    </div>
                                </div>
                            </div>
                            <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
                                <span class="fa fa-angle-left"></span>
                            </a>
                            <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
                                <span class="fa fa-angle-right"></span>
                            </a>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <div class="col-md-4">
                <div class="box box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title">为你推荐</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="col-md-12" style="display: flex;margin: 0 auto;">
                            <!--                        <div class="list-group" style="flex: 1; border-right: 1px #b8c7ce solid">-->
                            <!--                            <li href="#" class="list-group-item" style=" border: 0;">-->
                            <!--                                分类-->
                            <!--                            </li>-->
                            <!--                            <a href="#" class="list-group-item" style=" border: 0;">Dapibus </a>-->
                            <!--                        </div>-->
                            <!--                        <div class="list-group" style="flex: 3;">-->
                            <!--                            <li href="#" class="list-group-item" style=" border: 0;">电影 </li>-->
                            <!--                            <a href="#" class="list-group-item" style=" border: 0;"><span class="badge">14</span>Morbi leo </a>-->
                            <!--                        </div>-->
                            <ul class="mailbox-attachments clearfix">
                                <li style="width: 31%" v-for="r in rList">
                                    <a class="mailbox-attachment-icon" :href="'/detail?id='+r.id">
                                        <img :src="r.icon" width="100%" height="228px">
                                    </a>

                                    <div class="mailbox-attachment-info">
                                        <a :href="'/detail?id='+r.id" class="mailbox-attachment-name">{{r.name}} <strong style="font-size: 5px;color: #f39a0d;">{{r.score}}</strong></a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <div class="col-md-1"></div>
        </div>
        <div class="movie row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <div class="box box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title">全部电影 <font style="font-size: 2px;">{{msg}}</font></h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body">
                        <div class="col-md-2">
                            <div class="list-group" style="flex: 1; border-right: 1px #b8c7ce solid">
                                <li href="#" class="list-group-item " style=" border: 0;">
                                    <strong>分类</strong>
                                </li>
                                <a class="list-group-item" style=" border: 0;" @click="getAll">全部 </a>
                                <a v-for="c in cList" class="list-group-item" style=" border: 0;" @click="getMovieByCate(c.id)">{{c.value}}</a>
                            </div>
                        </div>
                        <div class="col-md-10">
                            <ul class="mailbox-attachments clearfix">
                                <li v-for="movie in mList">
                                    <a class="mailbox-attachment-icon" :href="'/detail?id='+movie.id">
                                        <img :src="movie.icon" width="100%" height="268px">
                                    </a>

                                    <div class="mailbox-attachment-info">
                                        <a :href="'/detail?id='+movie.id" class="mailbox-attachment-name">{{movie.name}} <strong style="font-size: 5px;color: #f39a0d;">{{movie.score}}</strong></a>
                                        <span class="mailbox-attachment-size">
                                    </span>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
        </div>
    </div>
</div>
</body>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            mList:[],
            cList:[],
            rList:[],
            msg: '',
            user: localStorage.getItem("user")
        },
        methods:{
            /**
             * 获取所有电影
             * @constructor
             */
            getMovieAll(){
                //this 的指向问题
                let scope=this
                $.ajax({
                    //请求方式
                    type:'GET',
                    //发送请求的地址
                    url:'/api/movie',
                    //服务器返回的数据类型
                    dataType:'json',
                    success:function(data){
                        //请求成功函数内容
                        scope.mList=data.result
                    },
                    error:function(jqXHR){
                        //请求失败函数内容
                        scope.msg = '加载失败'
                    }
                });
            },
            /**
             * 获取所有分类
             * @constructor
             */
            getCategoryAll(){
                //this 的指向问题
                let scope=this
                $.ajax({
                    //请求方式
                    type:'GET',
                    //发送请求的地址
                    url:'/api/category',
                    //服务器返回的数据类型
                    dataType:'json',
                    success:function(data){
                        //请求成功函数内容
                        scope.cList=data.result
                    },
                    error:function(jqXHR){
                        //请求失败函数内容
                        scope.msg = '加载失败'
                    }
                });
            },
            /**
             * 推荐
             */
            randTree() {
                //this 的指向问题
                let scope=this
                $.ajax({
                    //请求方式
                    type:'GET',
                    //发送请求的地址
                    url:'/api/movie/rand',
                    //服务器返回的数据类型
                    dataType:'json',
                    success:function(data){
                        //请求成功函数内容
                        scope.rList=data.result
                    },
                    error:function(jqXHR){
                        //请求失败函数内容
                        scope.msg = '加载失败'
                    }
                });
            },
            /**
             * 根据分类id查电影
             */
            getMovieByCate(id){
                let that = this
                $.ajax({
                    //请求方式
                    type:'GET',
                    //发送请求的地址
                    url:'/api/movie/c/'+id,
                    //服务器返回的数据类型
                    dataType:'json',
                    success:function(data){
                        //请求成功函数内容
                        that.mList=data.result
                        // console.log(data.result+that.cate)
                    },
                    error:function(){
                        //请求失败函数内容
                        that.msg = '加载失败'
                    }
                });
            },
            getAll() {
                this.getMovieAll()
            },
            logout(){
                // alert("确定注销吗?")
                var sure = window.confirm("确定注销吗?")
                if (sure) {
                    localStorage.clear()
                }
            },
            /**
             * 根据id查用户详细信息
             * @constructor
             */
            getUserById(id) {
                let that = this
                $.ajax({
                    //请求方式
                    type:'GET',
                    //发送请求的地址
                    url:'/api/user/'+id,
                    //服务器返回的数据类型
                    dataType:'json',
                    success:function(data){
                        //请求成功函数内容
                        that.user=data.result
                    },
                    error:function(){
                        //请求失败函数内容
                        that.msg = '加载失败'
                    }
                });
            },
        },
        created:function(){
            this.randTree()
            this.getMovieAll()
            this.getCategoryAll()
            // 判断本地浏览器中用户是否存在, 存在即登陆了
            if (localStorage.getItem("user")){
                // this.user = localStorage.getItem("user")
                this.getUserById(localStorage.getItem("user"))
            } else {
                this.user = null
            }
        }
    })
</script>
<script>
    $(function () {
        /* BOOTSTRAP SLIDER */
        $('.slider').slider()
    })
</script>
</html>